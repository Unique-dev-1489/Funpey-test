<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun Pay - Educational Payment App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- QR Code Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <style>
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        .phone-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
        }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 480px;
            margin: 0 auto;
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }
        .transaction-item {
            transition: all 0.2s ease;
            position: relative;
        }
        .transaction-item:hover {
            background-color: #f9fafb;
        }
        .transaction-item.long-press {
            background-color: #fee2e2;
            border-left: 4px solid #ef4444;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .debit-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 20px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        .debit-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        }
        .chip {
            width: 40px;
            height: 30px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-radius: 4px;
            position: relative;
        }
        .pin-input {
            letter-spacing: 8px;
            text-align: center;
            font-size: 24px;
        }
        .success-animation {
            animation: successPulse 1.5s ease-in-out;
        }
        @keyframes successPulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .big-amount {
            font-size: 3rem;
            font-weight: bold;
            line-height: 1;
        }
        .success-message {
            background-color: #f0fdf4;
            border-left: 4px solid #22c55e;
            padding: 10px 15px;
            margin-top: 15px;
            border-radius: 4px;
            display: flex;
            align-items: center;
        }
        .success-message i {
            color: #22c55e;
            margin-right: 10px;
        }
        #qr-reader {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
        }
        #qr-reader video {
            width: 100%;
            height: auto;
        }
        .qr-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        #qrcode {
            margin: 20px 0;
        }
        .terms-content {
            height: 60vh;
            overflow-y: auto;
            padding: 15px;
            background-color: #f9fafb;
            border-radius: 8px;
            margin: 15px 0;
        }
        .contact-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .delete-confirmation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .delete-confirmation-content {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        /* Reward specific styles */
        .reward-badge {
            background-color: #f0abfc;
            color: #701a75;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        /* Long press instruction */
        .long-press-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1001;
            animation: fadeIn 0.3s ease-in;
            display: none;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD_jqTqBlb2Dk-muoOCGKU9eQbeQvNFKWY",
            authDomain: "fun-pay-a2cf0.firebaseapp.com",
            databaseURL: "https://fun-pay-a2cf0-default-rtdb.firebaseio.com",
            projectId: "fun-pay-a2cf0",
            storageBucket: "fun-pay-a2cf0.firebasestorage.app",
            messagingSenderId: "238563276663",
            appId: "1:238563276663:web:313b1cf7f5bd6dbd075372"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();

        // App state
        let currentUser = null;
        let appSettings = {
            bankName: "Children Bank of India",
            defaultProfileIcon: "https://picsum.photos/seed/default/200/200.jpg",
            userInviteCode: "FUNUSER2024"
        };
        
        // Store last transaction for receipt
        let lastTransaction = null;
        let currentRewardData = null; // For reward feature
        let clickedTransaction = null; // For transaction popup
        
        // QR Code scanner instance
        let html5QrcodeScanner = null;
        
        // Scanned user data
        let scannedUserData = null;
        
        // Long press timer
        let longPressTimer = null;
        
        // Transaction to delete
        let transactionToDelete = null;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    currentUser = user;
                    loadUserData(user.uid);
                    // Check for reward link in URL after login
                    checkForRewardLink();
                    showScreen('home');
                } else {
                    // If not logged in, still check for link to prompt login
                    checkForRewardLink();
                    showScreen('welcome');
                }
            });

            // Load app settings
            database.ref('settings').once('value').then(snapshot => {
                if (snapshot.exists()) {
                    appSettings = { ...appSettings, ...snapshot.val() };
                    updateBankName();
                }
            });
            
            // Enable/disable proceed button based on disclaimer checkbox
            const disclaimerCheck = document.getElementById('disclaimerCheck');
            if (disclaimerCheck) {
                disclaimerCheck.addEventListener('change', function() {
                    const proceedBtn = document.getElementById('proceedBtn');
                    if (proceedBtn) {
                        proceedBtn.disabled = !this.checked;
                    }
                });
            }
        });

        // --- REWARD FEATURE FUNCTIONS ---

        function checkForRewardLink() {
            const urlParams = new URLSearchParams(window.location.search);
            const rewardId = urlParams.get('rewardId');
            if (rewardId) {
                // User is not logged in, show login screen
                if (!currentUser) {
                    showScreen('signin');
                    alert('Please sign in to claim this reward.');
                    return;
                }
                // User is logged in, fetch reward data
                database.ref('rewards/' + rewardId).once('value').then(snapshot => {
                    if (snapshot.exists()) {
                        const reward = snapshot.val();
                        if (reward.status === 'completed') {
                            alert('This reward has already been claimed.');
                            window.history.replaceState({}, document.title, window.location.pathname);
                            showScreen('home');
                            return;
                        }
                        if (reward.userId === currentUser.uid) {
                            alert('You cannot claim your own reward!');
                            window.history.replaceState({}, document.title, window.location.pathname);
                            showScreen('home');
                            return;
                        }
                        currentRewardData = reward;
                        displayClaimRewardScreen();
                    } else {
                        alert('Invalid or expired reward link.');
                        window.history.replaceState({}, document.title, window.location.pathname);
                        showScreen('home');
                    }
                });
            }
        }

        function displayClaimRewardScreen() {
            document.getElementById('rewardUserName').textContent = currentRewardData.userName;
            document.getElementById('rewardUserAccount').textContent = currentRewardData.userAccount;
            document.getElementById('rewardPaymentAmount').textContent = '₹' + currentRewardData.amount.toFixed(2);
            showScreen('claimReward');
        }

        function generateRewardLink() {
            const amount = parseFloat(document.getElementById('rewardAmount').value);
            const description = document.getElementById('rewardDescription').value;

            if (!amount || amount <= 0) {
                alert('Please enter a valid amount.');
                return;
            }

            const rewardId = 'RWD' + Date.now();
            const baseUrl = window.location.origin + window.location.pathname;
            const rewardLink = `${baseUrl}?rewardId=${rewardId}`;

            database.ref('users/' + currentUser.uid).once('value').then(snapshot => {
                const userData = snapshot.val();
                const rewardData = {
                    rewardId: rewardId,
                    userId: currentUser.uid,
                    userName: userData.displayName,
                    userAccount: userData.accountNumber,
                    amount: amount,
                    description: description || 'Reward Payment',
                    status: 'pending',
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                database.ref('rewards/' + rewardId).set(rewardData).then(() => {
                    document.getElementById('rewardLink').value = rewardLink;
                    document.getElementById('generatedRewardLinkContainer').classList.remove('hidden');
                });
            });
        }

        function proceedWithRewardPayment() {
            if (!currentRewardData) return;
            showScreen('rewardPinVerification');
        }

        function verifyRewardPinAndPay() {
            const pin = document.getElementById('rewardPinInput').value;
            if (pin.length !== 4) {
                alert('PIN must be 4 digits.');
                return;
            }

            database.ref('users/' + currentUser.uid + '/pin').once('value').then(snapshot => {
                if (snapshot.val() === pin) {
                    processRewardPayment();
                } else {
                    alert('Invalid PIN. Please try again.');
                    document.getElementById('rewardPinInput').value = '';
                }
            });
        }

        function processRewardPayment() {
            const payerId = currentUser.uid;
            const recipientId = currentRewardData.userId;
            const amount = currentRewardData.amount;

            database.ref('users/' + payerId).once('value').then(payerSnapshot => {
                const payerData = payerSnapshot.val();
                if (payerData.balance < amount) {
                    alert('Insufficient balance.');
                    return;
                }
                database.ref('users/' + recipientId).once('value').then(recipientSnapshot => {
                    const recipientData = recipientSnapshot.val();
                    const transactionId = 'TXN' + Date.now();

                    const updates = {};
                    // Update balances
                    updates[`users/${payerId}/balance`] = payerData.balance - amount;
                    updates[`users/${recipientId}/balance`] = recipientData.balance + amount;

                    // Add transactions
                    const debitTransaction = {
                        transactionId, from: payerData.displayName, to: recipientData.displayName,
                        amount, note: currentRewardData.description, timestamp: Date.now(),
                        type: 'debit', paymentMethod: 'Reward Link'
                    };
                    const creditTransaction = { ...debitTransaction, type: 'credit' };
                    updates[`transactions/${payerId}/${Date.now()}`] = debitTransaction;
                    updates[`transactions/${recipientId}/${Date.now()}`] = creditTransaction;

                    // Update reward status
                    updates[`rewards/${currentRewardData.rewardId}/status`] = 'completed';
                    updates[`rewards/${currentRewardData.rewardId}/completedBy`] = payerId;
                    updates[`rewards/${currentRewardData.rewardId}/completedAt`] = firebase.database.ServerValue.TIMESTAMP;

                    // Send notification
                    updates[`notifications/${recipientId}/${Date.now()}`] = {
                        title: 'Reward Received!',
                        message: `${payerData.displayName} sent you ₹${amount.toFixed(2)} as a reward.`,
                        timestamp: Date.now()
                    };

                    database.ref().update(updates).then(() => {
                        showRewardPaymentSuccessScreen(transactionId);
                    }).catch(error => {
                        console.error("Payment failed:", error);
                        alert('Payment failed. Please try again.');
                    });
                });
            });
        }

        function showRewardPaymentSuccessScreen(transactionId) {
            document.getElementById('rewardPaidTo').textContent = currentRewardData.userName;
            document.getElementById('rewardPaidAmount').textContent = '₹' + currentRewardData.amount.toFixed(2);
            document.getElementById('rewardPaidDescription').textContent = currentRewardData.description;
            document.getElementById('rewardTransactionId').textContent = transactionId;
            document.getElementById('rewardPaymentDate').textContent = formatDate(Date.now());
            showScreen('rewardPaymentSuccess');
        }
        
        function copyRewardDescription() {
            const descriptionText = document.getElementById('rewardPaidDescription').textContent;
            if (descriptionText) {
                copyTextToClipboard(descriptionText);
            }
        }

        function resetAndGoHome() {
            currentRewardData = null;
            document.getElementById('rewardPinInput').value = '';
            window.history.replaceState({}, document.title, window.location.pathname);
            showScreen('home');
        }

        function copyToClipboard(elementId) {
            const textToCopy = document.getElementById(elementId).value;
            copyTextToClipboard(textToCopy);
        }
        
        function copyTextToClipboard(text) {
            if (!navigator.clipboard) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('Copied to clipboard!');
                } catch (err) {
                    alert('Oops, unable to copy');
                }
                document.body.removeChild(textArea);
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            }, (err) => {
                console.error('Could not copy text: ', err);
                alert('Oops, unable to copy');
            });
        }

        // --- TRANSACTION DETAILS FUNCTIONS ---

        function showTransactionPopup(transaction) {
            clickedTransaction = transaction;
            
            // Set popup data
            const isCredit = transaction.type === 'credit' || transaction.type === 'request';
            document.getElementById('popupIcon').className = isCredit ? 
                'w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4' : 
                'w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4';
            
            document.getElementById('popupIcon').innerHTML = isCredit ? 
                '<i class="fas fa-arrow-down text-green-500 text-3xl"></i>' : 
                '<i class="fas fa-arrow-up text-blue-500 text-3xl"></i>';
            
            document.getElementById('popupType').textContent = isCredit ? 'Money Received' : 'Money Sent';
            document.getElementById('popupFrom').textContent = transaction.from;
            document.getElementById('popupTo').textContent = transaction.to;
            document.getElementById('popupAmount').textContent = '₹' + transaction.amount.toFixed(2);
            document.getElementById('popupAmount').className = isCredit ? 
                'font-medium big-amount text-green-500' : 
                'font-medium big-amount text-blue-500';
            document.getElementById('popupNote').textContent = transaction.note || 'No note provided';
            document.getElementById('popupDate').textContent = formatDate(transaction.timestamp);
            document.getElementById('popupStatus').textContent = 'Successful';
            document.getElementById('popupStatus').className = 'font-medium text-green-500 text-right';
            document.getElementById('popupTransactionId').textContent = transaction.transactionId || 'TXN' + transaction.timestamp;
            
            showScreen('transactionPopup');
        }

        function sharePopupTransaction() {
            if (!clickedTransaction) return;
            
            const isCredit = clickedTransaction.type === 'credit' || clickedTransaction.type === 'request';
            const transactionType = isCredit ? 'Received' : 'Sent';
            
            const shareText = `${transactionType} via Fun Pay!\n\n${isCredit ? 'From:' : 'To:'} ${isCredit ? clickedTransaction.from : clickedTransaction.to}\nAmount: ₹${clickedTransaction.amount.toFixed(2)}\nNote: ${clickedTransaction.note || 'Payment'}\nDate: ${formatDate(clickedTransaction.timestamp)}\nTransaction ID: ${clickedTransaction.transactionId || 'TXN' + clickedTransaction.timestamp}\nStatus: Successful\n\nThis is an educational transaction from Fun Pay - Educational Payment App`;
            
            if (navigator.share) {
                navigator.share({
                    title: `Fun Pay - ${transactionType}`,
                    text: shareText
                }).catch(err => console.log('Error sharing:', err));
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Transaction details copied to clipboard!');
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                    alert('Unable to share. Please try again.');
                });
            }
        }

        function showPopupAsPaymentSuccess() {
            if (!clickedTransaction) return;
            
            // Set lastTransaction to the clicked one
            lastTransaction = clickedTransaction;
            
            // Update success screen
            document.getElementById('successRecipient').textContent = lastTransaction.to;
            document.getElementById('successAmount').textContent = '₹' + lastTransaction.amount.toFixed(2);
            document.getElementById('successNote').textContent = lastTransaction.note || 'Payment';
            document.getElementById('successDate').textContent = formatDate(lastTransaction.timestamp);
            document.getElementById('successTransactionId').textContent = lastTransaction.transactionId || 'TXN' + lastTransaction.timestamp;
            
            // Show success screen with animation
            showScreen('paymentSuccess');
            
            const successIcon = document.getElementById('successIcon');
            successIcon.classList.add('success-animation');
            
            setTimeout(() => {
                successIcon.classList.remove('success-animation');
            }, 1500);
        }

        function downloadPopupPDF() {
            if (!clickedTransaction) return;
            
            // Temporarily set lastTransaction to clicked one
            const originalTransaction = lastTransaction;
            lastTransaction = clickedTransaction;
            
            downloadPDFReceipt();
            
            // Restore original lastTransaction
            lastTransaction = originalTransaction;
        }

        // --- LONG PRESS TRANSACTION OPTIONS ---

        function showDeleteTransactionConfirmation(transactionKey) {
            transactionToDelete = transactionKey;
            
            // Get the transaction data
            database.ref('transactions/' + currentUser.uid + '/' + transactionKey).once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    cancelDeleteTransaction();
                    return;
                }
                
                const transaction = snapshot.val();
                
                // Create enhanced confirmation dialog
                const confirmationDiv = document.createElement('div');
                confirmationDiv.className = 'delete-confirmation';
                confirmationDiv.id = 'deleteTransactionConfirmation';
                
                const isCredit = transaction.type === 'credit' || transaction.type === 'request';
                const amountColor = isCredit ? 'text-green-600' : 'text-red-600';
                const amountSign = isCredit ? '+' : '-';
                
                confirmationDiv.innerHTML = `
                    <div class="delete-confirmation-content">
                        <div class="mb-4">
                            <h3 class="text-lg font-semibold text-gray-800 mb-3">Transaction Options</h3>
                            
                            <!-- Transaction Preview -->
                            <div class="bg-blue-50 border border-blue-100 rounded-lg p-3 mb-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-medium text-sm">${transaction.from === currentUser.displayName ? 'To: ' + transaction.to : 'From: ' + transaction.from}</p>
                                        <p class="text-xs text-gray-600 mt-1">${transaction.note || 'No description'}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="font-bold text-lg ${amountColor}">${amountSign}₹${transaction.amount.toFixed(2)}</p>
                                        <p class="text-xs text-gray-500 mt-1">${formatDate(transaction.timestamp).split(' ')[0]}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="space-y-3">
                            <button onclick="showTransactionDetailsFromPopup(${JSON.stringify(transaction).replace(/"/g, '&quot;')})" 
                                    class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition flex items-center justify-center">
                                <i class="fas fa-info-circle mr-2"></i>
                                View Transaction Details
                            </button>
                            
                            <div class="pt-3 border-t border-gray-200">
                                <p class="text-sm text-gray-600 mb-3 text-center">Want to remove this transaction?</p>
                                <div class="flex space-x-3">
                                    <button onclick="cancelDeleteTransaction()" 
                                            class="flex-1 bg-gray-200 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-300 transition">
                                        Cancel
                                    </button>
                                    <button onclick="deleteTransaction()" 
                                            class="flex-1 bg-red-500 text-white py-2 rounded-lg font-medium hover:bg-red-600 transition flex items-center justify-center">
                                        <i class="fas fa-trash mr-2"></i>
                                        Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(confirmationDiv);
            }).catch(error => {
                console.error('Error loading transaction:', error);
                cancelDeleteTransaction();
            });
        }

        // Helper function to show transaction details from popup
        function showTransactionDetailsFromPopup(transaction) {
            // Close the delete confirmation
            cancelDeleteTransaction();
            
            // Set the clicked transaction
            clickedTransaction = transaction;
            
            // Show the transaction popup
            showScreen('transactionPopup');
            
            // Update popup with transaction data
            const isCredit = transaction.type === 'credit' || transaction.type === 'request';
            document.getElementById('popupIcon').className = isCredit ? 
                'w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4' : 
                'w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4';
            
            document.getElementById('popupIcon').innerHTML = isCredit ? 
                '<i class="fas fa-arrow-down text-green-500 text-3xl"></i>' : 
                '<i class="fas fa-arrow-up text-blue-500 text-3xl"></i>';
            
            document.getElementById('popupType').textContent = isCredit ? 'Money Received' : 'Money Sent';
            document.getElementById('popupFrom').textContent = transaction.from;
            document.getElementById('popupTo').textContent = transaction.to;
            document.getElementById('popupAmount').textContent = '₹' + transaction.amount.toFixed(2);
            document.getElementById('popupAmount').className = isCredit ? 
                'font-medium big-amount text-green-500' : 
                'font-medium big-amount text-blue-500';
            document.getElementById('popupNote').textContent = transaction.note || 'No note provided';
            document.getElementById('popupDate').textContent = formatDate(transaction.timestamp);
            document.getElementById('popupStatus').textContent = 'Successful';
            document.getElementById('popupStatus').className = 'font-medium text-green-500 text-right';
            document.getElementById('popupTransactionId').textContent = transaction.transactionId || 'TXN' + transaction.timestamp;
        }

        // --- EXISTING APP FUNCTIONS ---

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-blue-600');
                btn.classList.add('text-gray-500');
            });
            
            if (screenId === 'home') {
                document.getElementById('homeNavBtn').classList.add('text-blue-600');
                document.getElementById('homeNavBtn').classList.remove('text-gray-500');
            } else if (screenId === 'history') {
                document.getElementById('historyNavBtn').classList.add('text-blue-600');
                document.getElementById('historyNavBtn').classList.remove('text-gray-500');
            } else if (screenId === 'profile') {
                document.getElementById('profileNavBtn').classList.add('text-blue-600');
                document.getElementById('profileNavBtn').classList.remove('text-gray-500');
            }
            
            // Stop QR scanner when leaving scan screen
            if (screenId !== 'scanQR' && html5QrcodeScanner) {
                html5QrcodeScanner.stop();
            }
            
            // Load data for specific screens
            if (screenId === 'history') {
                loadHistoryTransactions();
            } else if (screenId === 'changeName') {
                loadCurrentProfileName();
            }
        }

        function generateAccountNumber() {
            return 'FP' + Math.random().toString(36).substr(2, 9).toUpperCase();
        }

        function loadUserData(uid) {
            database.ref('users/' + uid).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    document.getElementById('userBalance').textContent = '₹' + userData.balance.toFixed(2);
                    document.getElementById('userName').textContent = userData.displayName || 'User';
                    document.getElementById('profileName').textContent = userData.displayName || 'User';
                    document.getElementById('profileEmail').textContent = userData.email;
                    document.getElementById('cardHolderName').textContent = userData.displayName || 'USER';
                    document.getElementById('cardNumber').textContent = formatCardNumber(userData.accountNumber);
                    document.getElementById('cardExpiry').textContent = userData.expiryDate || '12/28';
                    
                    // Update card balance
                    document.getElementById('cardBalance').textContent = '₹' + userData.balance.toFixed(2);
                    
                    if (userData.profileIcon) {
                        document.getElementById('profileIcon').src = userData.profileIcon;
                        document.getElementById('homeProfileIcon').src = userData.profileIcon;
                    }
                }
            });

            // Load transactions
            loadTransactions(uid);
            
            // Load notifications
            loadNotifications(uid);
        }

        function formatCardNumber(number) {
            return number.replace(/(\w{4})(\w{4})(\w{4})(\w{4})/, '$1 $2 $3 $4');
        }

        function loadTransactions(uid) {
            const transactionsRef = database.ref('transactions/' + uid);
            transactionsRef.orderByChild('timestamp').limitToLast(10).on('value', snapshot => {
                const transactionsList = document.getElementById('transactionsList');
                transactionsList.innerHTML = '';
                
                if (snapshot.exists()) {
                    const transactions = snapshot.val();
                    Object.keys(transactions).reverse().forEach(key => {
                        const transaction = transactions[key];
                        const transactionEl = createTransactionElement(transaction, key);
                        transactionsList.appendChild(transactionEl);
                    });
                } else {
                    transactionsList.innerHTML = '<p class="text-gray-500 text-center py-4">No transactions yet</p>';
                }
            });
        }

        function createTransactionElement(transaction, key) {
            const div = document.createElement('div');
            div.className = 'transaction-item p-3 border-b border-gray-100 cursor-pointer fade-in';
            div.dataset.transactionKey = key;
            
            const isCredit = transaction.type === 'credit' || transaction.type === 'request';
            const icon = isCredit ? 'fa-arrow-down text-green-500' : 'fa-arrow-up text-red-500';
            const name = transaction.from === currentUser.displayName ? 'To: ' + transaction.to : 'From: ' + transaction.from;
            
            div.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center mr-3">
                            <i class="fas ${icon}"></i>
                        </div>
                        <div>
                            <p class="font-medium text-sm">${name} ${transaction.paymentMethod === 'Reward Link' ? '<span class="reward-badge">REWARD</span>' : ''}</p>
                            <p class="text-xs text-gray-500">${transaction.note || 'Payment'}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-medium ${isCredit ? 'text-green-500' : 'text-red-500'}">
                            ${isCredit ? '+' : '-'}₹${transaction.amount.toFixed(2)}
                        </p>
                        <p class="text-xs text-gray-500">${formatDate(transaction.timestamp)}</p>
                    </div>
                </div>
            `;
            
            // Click event for direct view (if needed)
            div.addEventListener('click', (e) => {
                // Check if it was a long press (we'll handle long press separately)
                if (!longPressTimer) {
                    showTransactionPopup(transaction);
                }
            });
            
            // Add long press event
            div.addEventListener('mousedown', startLongPress);
            div.addEventListener('touchstart', startLongPress);
            div.addEventListener('mouseup', cancelLongPress);
            div.addEventListener('touchend', cancelLongPress);
            div.addEventListener('mouseleave', cancelLongPress);
            
            return div;
        }
        
        function startLongPress(e) {
            e.preventDefault();
            const transactionEl = e.currentTarget;
            
            longPressTimer = setTimeout(() => {
                transactionEl.classList.add('long-press');
                const transactionKey = transactionEl.dataset.transactionKey;
                showDeleteTransactionConfirmation(transactionKey);
            }, 800);
        }
        
        function cancelLongPress() {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
            
            document.querySelectorAll('.transaction-item').forEach(item => {
                item.classList.remove('long-press');
            });
        }
        
        function cancelDeleteTransaction() {
            const confirmationDiv = document.getElementById('deleteTransactionConfirmation');
            if (confirmationDiv) {
                document.body.removeChild(confirmationDiv);
            }
            transactionToDelete = null;
        }
        
        function deleteTransaction() {
            if (!transactionToDelete) return;
            
            database.ref('transactions/' + currentUser.uid + '/' + transactionToDelete).remove()
                .then(() => {
                    alert('Transaction deleted successfully');
                    cancelDeleteTransaction();
                })
                .catch(error => {
                    console.error('Error deleting transaction:', error);
                    alert('Failed to delete transaction');
                });
        }

        function loadNotifications(uid) {
            const notificationsRef = database.ref('notifications/' + uid);
            notificationsRef.orderByChild('timestamp').limitToLast(10).on('value', snapshot => {
                const notificationsList = document.getElementById('notificationsList');
                notificationsList.innerHTML = '';
                
                if (snapshot.exists()) {
                    const notifications = snapshot.val();
                    Object.keys(notifications).reverse().forEach(key => {
                        const notification = notifications[key];
                        const notificationEl = createNotificationElement(notification);
                        notificationsList.appendChild(notificationEl);
                    });
                } else {
                    notificationsList.innerHTML = '<p class="text-gray-500 text-center py-4">No notifications</p>';
                }
            });
        }

        function createNotificationElement(notification) {
            const div = document.createElement('div');
            div.className = 'p-3 border-b border-gray-100 fade-in';
            
            div.innerHTML = `
                <div class="flex items-start">
                    <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center mr-3 flex-shrink-0">
                        <i class="fas fa-bell text-blue-500 text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium">${notification.title}</p>
                        <p class="text-xs text-gray-600 mt-1">${notification.message}</p>
                        <p class="text-xs text-gray-400 mt-1">${formatDate(notification.timestamp)}</p>
                    </div>
                </div>
            `;
            
            return div;
        }

        function signUpUser() {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const displayName = document.getElementById('signupName').value;
            const inviteCode = document.getElementById('signupInviteCode').value;
            const pin = document.getElementById('signupPin').value;
            const confirmPin = document.getElementById('signupConfirmPin').value;
            
            if (!email || !password || !displayName || !inviteCode || !pin) {
                alert('Please fill all fields');
                return;
            }
            
            if (inviteCode !== appSettings.userInviteCode) {
                alert('Invalid invite code');
                return;
            }
            
            if (pin.length !== 4 || pin !== confirmPin) {
                alert('PIN must be 4 digits and match');
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    const accountNumber = generateAccountNumber();
                    const expiryDate = '12/' + (new Date().getFullYear() + 5).toString().substr(2);
                    
                    database.ref('users/' + user.uid).set({
                        uid: user.uid,
                        email: email,
                        displayName: displayName,
                        accountNumber: accountNumber,
                        pin: pin,
                        expiryDate: expiryDate,
                        balance: 1000,
                        profileIcon: appSettings.defaultProfileIcon,
                        createdAt: Date.now()
                    });
                    
                    database.ref('notifications/' + user.uid).push({
                        title: 'Welcome to Fun Pay!',
                        message: `Your account ${accountNumber} has been created with ₹1000 starting balance.`,
                        timestamp: Date.now()
                    });
                    
                    return user.updateProfile({ displayName: displayName });
                })
                .catch(error => {
                    alert(error.message);
                });
        }

        function signIn() {
            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;
            const accountNumber = document.getElementById('signinAccountNumber').value;
            
            if (!email || !password || !accountNumber) {
                alert('Please fill all fields');
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    return database.ref('users/' + userCredential.user.uid).once('value');
                })
                .then(snapshot => {
                    if (snapshot.exists() && snapshot.val().accountNumber === accountNumber) {
                        // Valid login
                    } else {
                        throw new Error('Invalid account number');
                    }
                })
                .catch(error => {
                    alert(error.message);
                    auth.signOut();
                });
        }

        function signOut() {
            auth.signOut();
        }

        function verifyPin(callback) {
            const pin = prompt('Enter your 4-digit PIN:');
            if (pin && pin.length === 4) {
                database.ref('users/' + currentUser.uid + '/pin').once('value').then(snapshot => {
                    if (snapshot.val() === pin) {
                        callback();
                    } else {
                        alert('Invalid PIN');
                    }
                });
            }
        }

        function sendMoney() {
            const recipient = document.getElementById('recipient').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const note = document.getElementById('note').value;
            
            if (!recipient || !amount || amount <= 0) {
                alert('Please fill all fields with valid values');
                return;
            }
            
            verifyPin(() => {
                database.ref('users/' + currentUser.uid).once('value').then(snapshot => {
                    const userData = snapshot.val();
                    
                    if (userData.balance < amount) {
                        alert('Insufficient balance');
                        return;
                    }
                    
                    database.ref('users').orderByChild('accountNumber').equalTo(recipient).once('value').then(recipientSnapshot => {
                        if (!recipientSnapshot.exists()) {
                            database.ref('users').orderByChild('email').equalTo(recipient).once('value').then(emailSnapshot => {
                                if (!emailSnapshot.exists()) {
                                    alert('Recipient not found');
                                    return;
                                }
                                processTransaction(emailSnapshot.val(), amount, note, userData);
                            });
                        } else {
                            processTransaction(recipientSnapshot.val(), amount, note, userData);
                        }
                    });
                });
            });
        }

        function processTransaction(recipientData, amount, note, senderData) {
            const recipientId = Object.keys(recipientData)[0];
            const recipient = recipientData[recipientId];
            
            const updates = {};
            updates['users/' + currentUser.uid + '/balance'] = senderData.balance - amount;
            updates['users/' + recipientId + '/balance'] = recipient.balance + amount;
            
            const transactionId = 'TXN' + Date.now();
            
            const transactionData = {
                transactionId: transactionId,
                from: senderData.displayName,
                to: recipient.displayName,
                amount: amount,
                note: note,
                timestamp: Date.now(),
                type: 'debit'
            };
            
            updates['transactions/' + currentUser.uid + '/' + Date.now()] = transactionData;
            
            const creditTransaction = { ...transactionData, type: 'credit' };
            updates['transactions/' + recipientId + '/' + Date.now()] = creditTransaction;
            
            updates['notifications/' + recipientId + '/' + Date.now()] = {
                title: 'Money Received',
                message: `${senderData.displayName} sent you ₹${amount.toFixed(2)}`,
                timestamp: Date.now()
            };
            
            lastTransaction = {
                ...transactionData,
                senderAccountNumber: senderData.accountNumber,
                recipientAccountNumber: recipient.accountNumber,
                transactionId: transactionId
            };
            
            database.ref().update(updates).then(() => {
                document.getElementById('recipient').value = '';
                document.getElementById('amount').value = '';
                document.getElementById('note').value = '';
                
                showPaymentSuccess();
            });
        }

        function showPaymentSuccess() {
            if (!lastTransaction) return;
            
            document.getElementById('successRecipient').textContent = lastTransaction.to;
            document.getElementById('successAmount').textContent = '₹' + lastTransaction.amount.toFixed(2);
            document.getElementById('successNote').textContent = lastTransaction.note || 'Payment';
            document.getElementById('successDate').textContent = formatDate(lastTransaction.timestamp);
            document.getElementById('successTransactionId').textContent = lastTransaction.transactionId;
            
            showScreen('paymentSuccess');
            
            const successIcon = document.getElementById('successIcon');
            successIcon.classList.add('success-animation');
            
            setTimeout(() => {
                successIcon.classList.remove('success-animation');
            }, 1500);
        }

        function shareTransaction() {
            if (!lastTransaction) return;
            
            const shareText = `Payment Successful!\n\nPaid: ₹${lastTransaction.amount.toFixed(2)}\nTo: ${lastTransaction.to}\nNote: ${lastTransaction.note || 'Payment'}\nDate: ${formatDate(lastTransaction.timestamp)}\nTransaction ID: ${lastTransaction.transactionId}\n\nSent via Fun Pay - Educational Payment App`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Fun Pay - Payment Successful',
                    text: shareText
                }).catch(err => console.log('Error sharing:', err));
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Transaction details copied to clipboard!');
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                    alert('Unable to share. Please try again.');
                });
            }
        }

        function downloadPDFReceipt() {
            if (!lastTransaction) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.setTextColor(66, 133, 244);
            doc.text('Fun Pay', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(100);
            doc.text('Educational Payment Platform', 105, 27, { align: 'center' });
            
            doc.setFontSize(16);
            doc.setTextColor(0);
            doc.text('Payment Receipt', 105, 40, { align: 'center' });
            
            doc.setFontSize(12);
            doc.text('Transaction Details', 20, 55);
            
            doc.setFontSize(10);
            doc.text(`Transaction ID: ${lastTransaction.transactionId}`, 20, 65);
            doc.text(`Date: ${formatDate(lastTransaction.timestamp)}`, 20, 72);
            doc.text(`Status: Successful`, 20, 79);
            
            doc.setFontSize(12);
            doc.text('Payment Details', 20, 95);
            
            doc.setFontSize(10);
            doc.text(`From: ${lastTransaction.from}`, 20, 105);
            doc.text(`To: ${lastTransaction.to}`, 20, 112);
            doc.text(`Amount: ₹${lastTransaction.amount.toFixed(2)}`, 20, 119);
            doc.text(`Note: ${lastTransaction.note || 'Payment'}`, 20, 126);
            
            doc.setFontSize(8);
            doc.setTextColor(150);
            doc.text('This is an educational receipt. No real money was involved.', 105, 280, { align: 'center' });
            doc.text('© 2023 Fun Pay - Educational Platform', 105, 285, { align: 'center' });
            
            doc.save(`FunPay_Receipt_${lastTransaction.transactionId}.pdf`);
        }

        function requestMoney() {
            const recipient = document.getElementById('requestRecipient').value;
            const amount = parseFloat(document.getElementById('requestAmount').value);
            const note = document.getElementById('requestNote').value;
            
            if (!recipient || !amount || amount <= 0) {
                alert('Please fill all fields with valid values');
                return;
            }
            
            database.ref('users').orderByChild('accountNumber').equalTo(recipient).once('value').then(recipientSnapshot => {
                if (!recipientSnapshot.exists()) {
                    database.ref('users').orderByChild('email').equalTo(recipient).once('value').then(emailSnapshot => {
                        if (!emailSnapshot.exists()) {
                            alert('Recipient not found');
                            return;
                        }
                        processRequest(emailSnapshot.val(), amount, note);
                    });
                } else {
                    processRequest(recipientSnapshot.val(), amount, note);
                }
            });
        }

        function processRequest(recipientData, amount, note) {
            const recipientId = Object.keys(recipientData)[0];
            const recipient = recipientData[recipientId];
            
            database.ref('notifications/' + recipientId).push({
                title: 'Money Request',
                message: `${currentUser.displayName} requested ₹${amount.toFixed(2)}`,
                timestamp: Date.now(),
                requestId: Date.now(),
                requestFrom: currentUser.uid,
                amount: amount,
                note: note
            });
            
            alert('Request sent successfully!');
            document.getElementById('requestRecipient').value = '';
            document.getElementById('requestAmount').value = '';
            document.getElementById('requestNote').value = '';
            showScreen('home');
        }

        function uploadProfilePicture() {
            const file = document.getElementById('profilePictureInput').files[0];
            
            if (!file) return;
            
            const storageRef = storage.ref('profilePictures/' + currentUser.uid);
            const uploadTask = storageRef.put(file);
            
            uploadTask.on('state_changed', 
                (snapshot) => {
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done');
                },
                (error) => {
                    alert(error.message);
                },
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        database.ref('users/' + currentUser.uid + '/profileIcon').set(downloadURL);
                        document.getElementById('profileIcon').src = downloadURL;
                        document.getElementById('homeProfileIcon').src = downloadURL;
                    });
                }
            );
        }

        function changePin() {
            const currentPin = document.getElementById('currentPin').value;
            const newPin = document.getElementById('newPin').value;
            const confirmPin = document.getElementById('confirmNewPin').value;
            
            if (!currentPin || !newPin || !confirmPin) {
                alert('Please fill all fields');
                return;
            }
            
            if (newPin.length !== 4) {
                alert('New PIN must be 4 digits');
                return;
            }
            
            if (newPin !== confirmPin) {
                alert('New PIN and confirmation do not match');
                return;
            }
            
            database.ref('users/' + currentUser.uid + '/pin').once('value').then(snapshot => {
                if (snapshot.val() === currentPin) {
                    database.ref('users/' + currentUser.uid + '/pin').set(newPin).then(() => {
                        alert('PIN changed successfully!');
                        document.getElementById('currentPin').value = '';
                        document.getElementById('newPin').value = '';
                        document.getElementById('confirmNewPin').value = '';
                        showScreen('profile');
                    });
                } else {
                    alert('Current PIN is incorrect');
                }
            });
        }

        function updateBankName() {
            document.getElementById('bankName').textContent = appSettings.bankName;
            document.getElementById('homeBankName').textContent = appSettings.bankName;
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        
        // QR Code Functions
        
        function generateQRCode() {
            database.ref('users/' + currentUser.uid).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    
                    document.getElementById('qrcode').innerHTML = '';
                    
                    const qrData = JSON.stringify({
                        uid: userData.uid,
                        accountNumber: userData.accountNumber,
                        displayName: userData.displayName,
                        bankName: appSettings.bankName
                    });
                    
                    new QRCode(document.getElementById('qrcode'), {
                        text: qrData,
                        width: 200,
                        height: 200,
                        colorDark: "#000000",
                        colorLight: "#ffffff",
                        correctLevel: QRCode.CorrectLevel.H
                    });
                    
                    document.getElementById('qrAccountNumber').textContent = userData.accountNumber;
                    document.getElementById('qrDisplayName').textContent = userData.displayName;
                    document.getElementById('qrBankName').textContent = appSettings.bankName;
                    
                    showScreen('showQR');
                }
            });
        }
        
        function startQRScanner() {
            showScreen('scanQR');
            
            if (!html5QrcodeScanner) {
                html5QrcodeScanner = new Html5Qrcode("qr-reader");
            }
            
            html5QrcodeScanner.start(
                { facingMode: "environment" },
                {
                    fps: 10,
                    qrbox: { width: 250, height: 250 }
                },
                (decodedText, decodedResult) => {
                    try {
                        const userData = JSON.parse(decodedText);
                        scannedUserData = userData;
                        html5QrcodeScanner.stop();
                        showQRPaymentScreen(userData);
                    } catch (error) {
                        alert('QR SCANNED');
                    }
                },
                (errorMessage) => {
                    // Handle scan error silently
                }
            ).catch((err) => {
                console.error(`Unable to start scanning: ${err}`);
                alert('Unable to access camera. Please check permissions.');
            });
        }
        
        function showQRPaymentScreen(userData) {
            document.getElementById('qrPayAccountNumber').textContent = userData.accountNumber;
            document.getElementById('qrPayDisplayName').textContent = userData.displayName;
            document.getElementById('qrPayBankName').textContent = userData.bankName;
            document.getElementById('qrPayAmount').value = '';
            showScreen('qrPay');
        }
        
        function processQRPayment() {
            const amount = parseFloat(document.getElementById('qrPayAmount').value);
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            verifyPin(() => {
                database.ref('users/' + currentUser.uid).once('value').then(snapshot => {
                    const userData = snapshot.val();
                    
                    if (userData.balance < amount) {
                        alert('Insufficient balance');
                        return;
                    }
                    
                    database.ref('users/' + scannedUserData.uid).once('value').then(recipientSnapshot => {
                        if (recipientSnapshot.exists()) {
                            const recipientData = recipientSnapshot.val();
                            processQRTransaction(recipientData, amount, userData);
                        } else {
                            alert('Recipient account not found');
                        }
                    });
                });
            });
        }
        
        function processQRTransaction(recipientData, amount, senderData) {
            const updates = {};
            updates['users/' + currentUser.uid + '/balance'] = senderData.balance - amount;
            updates['users/' + recipientData.uid + '/balance'] = recipientData.balance + amount;
            
            const transactionId = 'TXN' + Date.now();
            
            const transactionData = {
                transactionId: transactionId,
                from: senderData.displayName,
                to: recipientData.displayName,
                amount: amount,
                note: 'QR Code Payment',
                timestamp: Date.now(),
                type: 'debit',
                paymentMethod: 'QR Code'
            };
            
            updates['transactions/' + currentUser.uid + '/' + Date.now()] = transactionData;
            
            const creditTransaction = { ...transactionData, type: 'credit' };
            updates['transactions/' + recipientData.uid + '/' + Date.now()] = creditTransaction;
            
            updates['notifications/' + recipientData.uid + '/' + Date.now()] = {
                title: 'Money Received',
                message: `${senderData.displayName} sent you ₹${amount.toFixed(2)} via QR Code`,
                timestamp: Date.now()
            };
            
            lastTransaction = {
                ...transactionData,
                senderAccountNumber: senderData.accountNumber,
                recipientAccountNumber: recipientData.accountNumber,
                transactionId: transactionId
            };
            
            database.ref().update(updates).then(() => {
                document.getElementById('qrPayAmount').value = '';
                showPaymentSuccess();
            });
        }
        
        function changeProfileName() {
            const newName = document.getElementById('newProfileName').value;
            
            if (!newName || newName.trim() === '') {
                alert('Please enter a valid name');
                return;
            }
            
            currentUser.updateProfile({ displayName: newName })
                .then(() => {
                    database.ref('users/' + currentUser.uid + '/displayName').set(newName)
                        .then(() => {
                            document.getElementById('userName').textContent = newName;
                            document.getElementById('profileName').textContent = newName;
                            document.getElementById('cardHolderName').textContent = newName.toUpperCase();
                            
                            document.getElementById('newProfileName').value = '';
                            alert('Profile name updated successfully!');
                            showScreen('profile');
                        })
                        .catch(error => {
                            alert('Error updating profile: ' + error.message);
                        });
                })
                .catch(error => {
                    alert('Error updating profile: ' + error.message);
                });
        }
        
        function loadCurrentProfileName() {
            database.ref('users/' + currentUser.uid + '/displayName').once('value').then(snapshot => {
                if (snapshot.exists()) {
                    document.getElementById('newProfileName').value = snapshot.val();
                }
            });
        }
        
        function deleteAccount() {
            const confirmationText = document.getElementById('deleteConfirmationText').value;
            
            if (confirmationText !== 'DELETE') {
                alert('Please type DELETE in capital letters to confirm');
                return;
            }
            
            database.ref('users/' + currentUser.uid).once('value').then(snapshot => {
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    
                    const confirmMessage = `Are you sure you want to permanently delete your account?\n\nAccount Number: ${userData.accountNumber}\nName: ${userData.displayName}\nBalance: ₹${userData.balance.toFixed(2)}\n\nThis action cannot be undone.`;
                    
                    if (confirm(confirmMessage)) {
                        database.ref('users/' + currentUser.uid).remove()
                            .then(() => {
                                database.ref('transactions/' + currentUser.uid).remove()
                                    .then(() => {
                                        database.ref('notifications/' + currentUser.uid).remove()
                                            .then(() => {
                                                currentUser.delete()
                                                    .then(() => {
                                                        alert('Your account has been permanently deleted');
                                                        window.location.reload();
                                                    })
                                                    .catch(error => {
                                                        console.error('Error deleting user from Auth:', error);
                                                        alert('Error deleting account. Please try again.');
                                                    });
                                            })
                                            .catch(error => {
                                                console.error('Error deleting notifications:', error);
                                                alert('Error deleting account. Please try again.');
                                            });
                                    })
                                    .catch(error => {
                                        console.error('Error deleting transactions:', error);
                                        alert('Error deleting account. Please try again.');
                                    });
                            })
                            .catch(error => {
                                console.error('Error deleting user data:', error);
                                alert('Error deleting account. Please try again.');
                            });
                    }
                }
            });
        }
        
        function loadHistoryTransactions() {
            const transactionsRef = database.ref('transactions/' + currentUser.uid);
            transactionsRef.orderByChild('timestamp').limitToLast(20).on('value', snapshot => {
                const transactionsList = document.getElementById('historyTransactionsList');
                transactionsList.innerHTML = '';
                
                if (snapshot.exists()) {
                    const transactions = snapshot.val();
                    Object.keys(transactions).reverse().forEach(key => {
                        const transaction = transactions[key];
                        const transactionEl = createTransactionElement(transaction, key);
                        transactionsList.appendChild(transactionEl);
                    });
                } else {
                    transactionsList.innerHTML = '<p class="text-gray-500 text-center py-4">No transactions yet</p>';
                }
            });
        }
    </script>

    <!-- Welcome/Onboarding Screen -->
    <div id="welcome" class="screen active">
        <div class="phone-container bg-white">
            <div class="flex flex-col items-center justify-center min-h-screen p-6">
                <div class="mb-8 text-center">
                    <div class="w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 pulse">
                        <i class="fas fa-wallet text-white text-4xl"></i>
                    </div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Fun Pay</h1>
                    <p class="text-gray-600">Learn how digital payments work</p>
                </div>
                
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 w-full">
                    <h3 class="font-semibold text-yellow-800 mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Educational Disclaimer
                    </h3>
                    <p class="text-sm text-yellow-700 mb-3">
                        This is an educational app that simulates payment transactions. No real money is involved. 
                        This app is not affiliated with any bank or financial institution and is not approved by any app store.
                    </p>
                    <label class="flex items-center">
                        <input type="checkbox" id="disclaimerCheck" class="mr-2">
                        <span class="text-sm text-yellow-700">I understand this is for educational purposes only</span>
                    </label>
                </div>
                
                <div class="w-full space-y-3">
                    <button onclick="showScreen('signup')" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition disabled:bg-gray-300" id="proceedBtn" disabled>
                        User Sign Up
                    </button>
                    <button onclick="showScreen('signin')" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition">
                        User Sign In
                    </button>
                </div>
                
                <div class="mt-6 p-3 bg-blue-50 rounded-lg">
                    <p class="text-xs text-blue-700 text-center">
                        <i class="fas fa-info-circle mr-1"></i>
                        User Invite Code: <span class="font-mono font-bold">FUNUSER2024</span>
                    </p>
                </div>
                
                <div class="mt-6 text-center">
                    <p class="text-xs text-gray-500">© 2023 Fun Pay - Educational Platform</p>
                </div>
            </div>
        </div>
    </div>

    <!-- User Sign Up Screen -->
    <div id="signup" class="screen">
        <div class="phone-container bg-white">
            <div class="flex flex-col items-center justify-center min-h-screen p-6">
                <div class="mb-8 text-center">
                    <div class="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-plus text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
                    <p class="text-gray-600 mt-1">Join Fun Pay to learn about payments</p>
                </div>
                
                <div class="w-full space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="signupName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your name">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="signupEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your email">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="signupPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Create a password">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">4-Digit PIN</label>
                        <input type="password" id="signupPin" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pin-input" placeholder="••••" maxlength="4">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Confirm PIN</label>
                        <input type="password" id="signupConfirmPin" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pin-input" placeholder="••••" maxlength="4">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Invite Code</label>
                        <input type="text" id="signupInviteCode" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="FUNUSER2024">
                    </div>
                    
                    <button onclick="signUpUser()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                        Sign Up
                    </button>
                    
                    <div class="text-center">
                        <p class="text-sm text-gray-600">
                            Already have an account? 
                            <a href="#" onclick="showScreen('signin')" class="text-blue-500 hover:underline">Sign In</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign In Screen -->
    <div id="signin" class="screen">
        <div class="phone-container bg-white">
            <div class="flex flex-col items-center justify-center min-h-screen p-6">
                <div class="mb-8 text-center">
                    <div class="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-sign-in-alt text-white text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Welcome Back</h2>
                    <p class="text-gray-600 mt-1">Sign in to continue learning</p>
                </div>
                
                <div class="w-full space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="signinEmail" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your email">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Account Number</label>
                        <input type="text" id="signinAccountNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="FPXXXXXXXXX">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="signinPassword" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your password">
                    </div>
                    
                    <button onclick="signIn()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                        Sign In
                    </button>
                    
                    <div class="text-center">
                        <p class="text-sm text-gray-600">
                            Don't have an account? 
                            <a href="#" onclick="showScreen('signup')" class="text-blue-500 hover:underline">Sign Up</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Home/Dashboard Screen -->
    <div id="home" class="screen">
        <div class="phone-container bg-gray-50 pb-20">
            <!-- Header -->
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-b-3xl shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <div>
                        <p class="text-sm opacity-90">Good morning,</p>
                        <h2 class="text-xl font-bold" id="userName">User</h2>
                    </div>
                    <div class="relative">
                        <img id="homeProfileIcon" src="https://picsum.photos/seed/user/200/200.jpg" class="w-12 h-12 rounded-full border-2 border-white">
                        <div class="absolute bottom-0 right-0 w-4 h-4 bg-green-400 rounded-full border-2 border-white"></div>
                    </div>
                    <!-- Scan QR Button -->
                    <button onclick="startQRScanner()" class="w-10 h-10 bg-white/20 backdrop-blur rounded-full flex items-center justify-center">
                        <i class="fas fa-qrcode text-white"></i>
                    </button>
                </div>
                
                <div class="bg-white/20 backdrop-blur rounded-xl p-4">
                    <p class="text-sm opacity-90" id="homeBankName">Children Bank of India</p>
                    <p class="text-3xl font-bold mt-1" id="userBalance">₹0.00</p>
                    <p class="text-xs opacity-75 mt-1">Available Balance</p>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="px-6 mt-6">
                <div class="grid grid-cols-4 gap-4">
                    <button onclick="showScreen('send')" class="flex flex-col items-center p-3 bg-white rounded-xl shadow-sm hover:shadow-md transition">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-2">
                            <i class="fas fa-paper-plane text-blue-500"></i>
                        </div>
                        <span class="text-xs text-gray-700">Send</span>
                    </button>
                    
                    <button onclick="showScreen('request')" class="flex flex-col items-center p-3 bg-white rounded-xl shadow-sm hover:shadow-md transition">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-2">
                            <i class="fas fa-hand-holding-usd text-green-500"></i>
                        </div>
                        <span class="text-xs text-gray-700">Request</span>
                    </button>
                    
                    <button onclick="showScreen('notifications')" class="flex flex-col items-center p-3 bg-white rounded-xl shadow-sm hover:shadow-md transition relative">
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mb-2">
                            <i class="fas fa-bell text-orange-500"></i>
                        </div>
                        <span class="text-xs text-gray-700">Alerts</span>
                        <div class="notification-badge">3</div>
                    </button>
                    
                    <button onclick="showScreen('profile')" class="flex flex-col items-center p-3 bg-white rounded-xl shadow-sm hover:shadow-md transition">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-2">
                            <i class="fas fa-credit-card text-purple-500"></i>
                        </div>
                        <span class="text-xs text-gray-700">Card</span>
                    </button>
                </div>
                
                <!-- NEW REWARD BUTTON -->
                <div class="grid grid-cols-4 gap-4 mt-4">
                    <button onclick="showScreen('requestReward')" class="flex flex-col items-center p-3 bg-white rounded-xl shadow-sm hover:shadow-md transition">
                        <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mb-2">
                            <i class="fas fa-gift text-pink-500"></i>
                        </div>
                        <span class="text-xs text-gray-700">Reward</span>
                    </button>
                </div>
            </div>
            
            <!-- Recent Transactions -->
            <div class="px-6 mt-6">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-semibold text-gray-800">Recent Transactions</h3>
                    <button onclick="showScreen('history')" class="text-blue-500 text-sm hover:underline">View All</button>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm" id="transactionsList">
                    <p class="text-gray-500 text-center py-4">No transactions yet</p>
                </div>
            </div>
            
            <!-- Educational Banner -->
            <div class="px-6 mt-6">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                    <p class="text-xs text-blue-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        Remember: This is an educational app. No real money is involved.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Bottom Navigation -->
        <div class="bottom-nav bg-white border-t border-gray-200">
            <div class="grid grid-cols-4 py-2">
                <button onclick="showScreen('home')" class="nav-btn flex flex-col items-center py-2 text-blue-600" id="homeNavBtn">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-xs">Home</span>
                </button>
                
                <button onclick="showScreen('history')" class="nav-btn flex flex-col items-center py-2 text-gray-500" id="historyNavBtn">
                    <i class="fas fa-history text-xl mb-1"></i>
                    <span class="text-xs">History</span>
                </button>
                
                <button onclick="showScreen('profile')" class="nav-btn flex flex-col items-center py-2 text-gray-500" id="profileNavBtn">
                    <i class="fas fa-user text-xl mb-1"></i>
                    <span class="text-xs">Profile</span>
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Request Reward Screen -->
    <div id="requestReward" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-pink-500 text-white p-4 flex items-center">
                <button onclick="showScreen('home')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Request Reward</h2>
            </div>
            
            <!-- Reward Form -->
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Reward Amount (₹)</label>
                    <input type="number" id="rewardAmount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="Enter amount">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Reward Description</label>
                    <input type="text" id="rewardDescription" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" placeholder="What's this reward for?">
                </div>
                
                <button onclick="generateRewardLink()" class="w-full bg-pink-500 text-white py-3 rounded-lg font-medium hover:bg-pink-600 transition">
                    Generate Reward Link
                </button>
                
                <div id="generatedRewardLinkContainer" class="hidden mt-6 bg-gray-50 rounded-xl p-4">
                    <p class="text-sm text-gray-600 mb-2">Your reward link:</p>
                    <div class="flex items-center bg-white p-2 rounded border">
                        <input type="text" id="rewardLink" class="flex-1 bg-transparent outline-none text-sm" readonly>
                        <button onclick="copyToClipboard('rewardLink')" class="ml-2 text-pink-500 font-medium">Copy</button>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Share this link with others to receive your reward.</p>
                </div>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        When someone clicks your reward link, they'll be asked to pay the specified amount to you.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Claim Reward Screen -->
    <div id="claimReward" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-pink-500 text-white p-4 flex items-center">
                <button onclick="window.history.back();" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Reward Payment</h2>
            </div>
            
            <!-- Reward Details -->
            <div class="p-6">
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <div class="flex items-center mb-4">
                        <img id="rewardUserIcon" src="https://picsum.photos/seed/default/200/200.jpg" class="w-16 h-16 rounded-full mr-4">
                        <div>
                            <h3 id="rewardUserName" class="font-semibold text-lg">User Name</h3>
                            <p id="rewardUserAccount" class="text-sm text-gray-500">Account Number</p>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <div class="flex justify-between mb-4">
                            <span class="text-gray-600">Reward Amount:</span>
                            <span id="rewardPaymentAmount" class="font-semibold text-lg text-pink-500">₹0.00</span>
                        </div>
                    </div>
                </div>
                
                <button onclick="proceedWithRewardPayment()" class="w-full bg-pink-500 text-white py-3 rounded-lg font-medium hover:bg-pink-600 transition">
                    Continue to Pay
                </button>
                
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <p class="text-xs text-blue-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        You'll be asked to enter your PIN to complete this payment.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Reward PIN Verification Screen -->
    <div id="rewardPinVerification" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-pink-500 text-white p-4 flex items-center">
                <button onclick="showScreen('claimReward')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Enter PIN</h2>
            </div>
            
            <!-- PIN Form -->
            <div class="p-6">
                <p class="text-center text-gray-600 mb-6">Enter your 4-digit PIN to complete this payment</p>
                
                <div class="flex justify-center mb-8">
                    <input type="password" id="rewardPinInput" maxlength="4" class="pin-input w-48 text-center text-2xl border-b-2 border-gray-300 focus:border-pink-500 outline-none">
                </div>
                
                <button onclick="verifyRewardPinAndPay()" class="w-full bg-pink-500 text-white py-3 rounded-lg font-medium hover:bg-pink-600 transition">
                    Verify PIN & Pay
                </button>
            </div>
        </div>
    </div>

    <!-- NEW: Reward Payment Success Screen -->
    <div id="rewardPaymentSuccess" class="screen">
        <div class="phone-container bg-white">
            <div class="flex flex-col items-center justify-center min-h-screen p-6">
                <div class="mb-8 text-center">
                    <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i id="rewardSuccessIcon" class="fas fa-check text-green-500 text-3xl success-animation"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Payment Successful!</h2>
                    <p class="text-gray-600 mt-1">Your reward has been sent successfully.</p>
                </div>
                
                <div class="w-full bg-gray-50 rounded-xl p-6 mb-6">
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Paid to:</span>
                        <span class="font-medium" id="rewardPaidTo">User Name</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Amount:</span>
                        <span class="font-medium big-amount text-pink-500" id="rewardPaidAmount">₹0.00</span>
                    </div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-gray-600">Description:</span>
                        <div class="flex items-center">
                            <span id="rewardPaidDescription" class="font-medium mr-2 text-right">-</span>
                            <button onclick="copyRewardDescription()" class="text-blue-500 font-medium text-sm">Copy</button>
                        </div>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Transaction ID:</span>
                        <span class="font-medium text-xs" id="rewardTransactionId">TXN123456789</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Date:</span>
                        <span class="font-medium" id="rewardPaymentDate">DD/MM/YYYY</span>
                    </div>
                </div>
                
                <button onclick="resetAndGoHome()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                    Back to Home
                </button>
            </div>
        </div>
    </div>

    <!-- Transaction Details Popup Screen -->
    <div id="transactionPopup" class="screen">
        <div class="phone-container bg-white">
            <div class="flex flex-col items-center justify-center min-h-screen p-6">
                <!-- Close Button -->
                <button onclick="showScreen('history')" class="absolute top-4 right-4 text-gray-500">
                    <i class="fas fa-times text-xl"></i>
                </button>
                
                <div class="mb-8 text-center">
                    <div id="popupIcon" class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-500 text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Transaction Details</h2>
                    <p class="text-gray-600 mt-1" id="popupType">Payment</p>
                </div>
                
                <div class="w-full bg-gray-50 rounded-xl p-6 mb-6">
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">From:</span>
                        <span class="font-medium text-right" id="popupFrom">Sender</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">To:</span>
                        <span class="font-medium text-right" id="popupTo">Recipient</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Amount:</span>
                        <span class="font-medium big-amount text-blue-500" id="popupAmount">₹0.00</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Note:</span>
                        <span class="font-medium text-right" id="popupNote">Payment</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Date:</span>
                        <span class="font-medium text-right" id="popupDate">Today</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Status:</span>
                        <span class="font-medium text-green-500 text-right" id="popupStatus">Successful</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Transaction ID:</span>
                        <span class="font-medium text-xs text-right" id="popupTransactionId">TXN123456789</span>
                    </div>
                </div>
                
                <div class="w-full space-y-3">
                    <button onclick="sharePopupTransaction()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                        <i class="fas fa-share-alt mr-2"></i>Share Details
                    </button>
                    <button onclick="downloadPopupPDF()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition">
                        <i class="fas fa-download mr-2"></i>Download Receipt
                    </button>
                    <button onclick="showPopupAsPaymentSuccess()" class="w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition">
                        <i class="fas fa-redo mr-2"></i>Show as Payment Success
                    </button>
                    <button onclick="showScreen('history')" class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-50 transition">
                        Back to History
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Send Money Screen -->
    <div id="send" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-blue-500 text-white p-4 flex items-center">
                <button onclick="showScreen('home')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Send Money</h2>
            </div>
            
            <!-- Payment Method Tabs -->
            <div class="flex border-b border-gray-200">
                <button onclick="document.getElementById('accountMethod').classList.add('active'); document.getElementById('qrMethod').classList.remove('active'); document.getElementById('accountPayment').style.display='block'; document.getElementById('qrPayment').style.display='none';" id="accountMethod" class="flex-1 py-3 text-center font-medium text-blue-600 border-b-2 border-blue-600">
                    Account/Email
                </button>
                <button onclick="document.getElementById('qrMethod').classList.add('active'); document.getElementById('accountMethod').classList.remove('active'); document.getElementById('accountPayment').style.display='none'; document.getElementById('qrPayment').style.display='block';" id="qrMethod" class="flex-1 py-3 text-center font-medium text-gray-500">
                    QR Code
                </button>
            </div>
            
            <!-- Account/Email Payment Form -->
            <div id="accountPayment" class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Recipient</label>
                    <input type="text" id="recipient" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Account number or email">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount (₹)</label>
                    <input type="number" id="amount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0.00">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Note (Optional)</label>
                    <textarea id="note" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="What's this payment for?"></textarea>
                </div>
                
                <button onclick="sendMoney()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                    Send Money
                </button>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        This is a simulated transaction for educational purposes only.
                    </p>
                </div>
            </div>
            
            <!-- QR Code Payment Form -->
            <div id="qrPayment" class="p-6" style="display: none;">
                <div class="flex flex-col items-center justify-center py-8">
                    <div class="w-32 h-32 bg-gray-100 rounded-lg flex items-center justify-center mb-4">
                        <i class="fas fa-qrcode text-gray-400 text-5xl"></i>
                    </div>
                    <p class="text-gray-600 mb-6">Scan a QR code to pay</p>
                    <button onclick="startQRScanner()" class="bg-blue-500 text-white py-3 px-6 rounded-lg font-medium hover:bg-blue-600 transition">
                        <i class="fas fa-camera mr-2"></i>Scan QR Code
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Request Money Screen -->
    <div id="request" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-green-500 text-white p-4 flex items-center">
                <button onclick="showScreen('home')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Request Money</h2>
            </div>
            
            <!-- Form -->
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">From</label>
                    <input type="text" id="requestRecipient" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="Account number or email">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount (₹)</label>
                    <input type="number" id="requestAmount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="0.00">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Note (Optional)</label>
                    <textarea id="requestNote" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" rows="3" placeholder="What's this request for?"></textarea>
                </div>
                
                <button onclick="requestMoney()" class="w-full bg-green-500 text-white py-3 rounded-lg font-medium hover:bg-green-600 transition">
                    Send Request
                </button>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        This is a simulated request for educational purposes only.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Success Screen -->
    <div id="paymentSuccess" class="screen">
        <div class="phone-container bg-white">
            <div class="flex flex-col items-center justify-center min-h-screen p-6">
                <div class="mb-8 text-center">
                    <div id="successIcon" class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-green-500 text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800">Payment Successful!</h2>
                </div>
                
                <div class="w-full bg-gray-50 rounded-xl p-6 mb-6">
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">To:</span>
                        <span class="font-medium" id="successRecipient">Recipient</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Amount:</span>
                        <span class="font-medium big-amount text-blue-500" id="successAmount">₹0.00</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Note:</span>
                        <span class="font-medium" id="successNote">Payment</span>
                    </div>
                    <div class="flex justify-between mb-3">
                        <span class="text-gray-600">Date:</span>
                        <span class="font-medium" id="successDate">Today</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Transaction ID:</span>
                        <span class="font-medium text-xs" id="successTransactionId">TXN123456789</span>
                    </div>
                </div>
                
                <div class="w-full space-y-3">
                    <button onclick="shareTransaction()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                        <i class="fas fa-share-alt mr-2"></i>Share
                    </button>
                    <button onclick="downloadPDFReceipt()" class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-300 transition">
                        <i class="fas fa-download mr-2"></i>Download Receipt
                    </button>
                    <button onclick="showScreen('home')" class="w-full border border-gray-300 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-50 transition">
                        Done
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Screen -->
    <div id="history" class="screen">
        <div class="phone-container bg-gray-50 pb-20">
            <!-- Header -->
            <div class="bg-blue-500 text-white p-4">
                <h2 class="text-xl font-semibold">Transaction History</h2>
            </div>
            
            <!-- Transactions List -->
            <div class="p-4">
                <div id="historyTransactionsList" class="bg-white rounded-xl shadow-sm">
                    <p class="text-gray-500 text-center py-4">No transactions yet</p>
                </div>
            </div>
            
            <!-- Bottom Navigation -->
            <div class="bottom-nav bg-white border-t border-gray-200">
                <div class="grid grid-cols-4 py-2">
                    <button onclick="showScreen('home')" class="nav-btn flex flex-col items-center py-2 text-gray-500" id="homeNavBtn">
                        <i class="fas fa-home text-xl mb-1"></i>
                        <span class="text-xs">Home</span>
                    </button>
                    
                    <button onclick="showScreen('history')" class="nav-btn flex flex-col items-center py-2 text-blue-600" id="historyNavBtn">
                        <i class="fas fa-history text-xl mb-1"></i>
                        <span class="text-xs">History</span>
                    </button>
                    
                    <button onclick="showScreen('profile')" class="nav-btn flex flex-col items-center py-2 text-gray-500" id="profileNavBtn">
                        <i class="fas fa-user text-xl mb-1"></i>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Screen -->
    <div id="profile" class="screen">
        <div class="phone-container bg-gray-50 pb-20">
            <!-- Header -->
            <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-6">
                <div class="flex items-center mb-4">
                    <img id="profileIcon" src="https://picsum.photos/seed/user/200/200.jpg" class="w-20 h-20 rounded-full border-3 border-white mr-4">
                    <div>
                        <h2 class="text-xl font-bold" id="profileName">User</h2>
                        <p class="text-sm opacity-90" id="profileEmail">user@example.com</p>
                    </div>
                </div>
                
                <div class="bg-white/20 backdrop-blur rounded-xl p-4">
                    <p class="text-sm opacity-90" id="bankName">Children Bank of India</p>
                    <p class="text-lg font-bold mt-1" id="cardNumber">FPXXXX XXXX XXXX XXXX</p>
                    <p class="text-xs opacity-75 mt-1">Valid Thru: <span id="cardExpiry">12/28</span></p>
                </div>
            </div>
            
            <!-- Card Section -->
            <div class="px-6 mt-6">
                <h3 class="font-semibold text-gray-800 mb-3">Your Card</h3>
                <div class="debit-card p-6 text-white shadow-lg">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-xs opacity-75">Balance</p>
                            <p class="text-2xl font-bold" id="cardBalance">₹0.00</p>
                        </div>
                        <div class="chip"></div>
                    </div>
                    <div class="mt-8">
                        <p class="text-xs opacity-75">Card Holder</p>
                        <p class="text-lg font-medium" id="cardHolderName">USER</p>
                    </div>
                </div>
            </div>
            
            <!-- Profile Options -->
            <div class="px-6 mt-6">
                <h3 class="font-semibold text-gray-800 mb-3">Account Settings</h3>
                <div class="bg-white rounded-xl shadow-sm">
                    <button onclick="showScreen('requestReward')" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-pink-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-gift text-pink-500"></i>
                            </div>
                            <span class="font-medium">Request Reward</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="generateQRCode()" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-qrcode text-indigo-500"></i>
                            </div>
                            <span class="font-medium">Show QR Code</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="showScreen('changeName')" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user-edit text-blue-500"></i>
                            </div>
                            <span class="font-medium">Change Profile Name</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="showScreen('terms')" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-file-contract text-gray-500"></i>
                            </div>
                            <span class="font-medium">Terms and Conditions</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="showScreen('help')" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-question-circle text-green-500"></i>
                            </div>
                            <span class="font-medium">Help and Support</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="showScreen('changePin')" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-lock text-blue-500"></i>
                            </div>
                            <span class="font-medium">Change PIN</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="document.getElementById('profilePictureInput').click()" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-camera text-green-500"></i>
                            </div>
                            <span class="font-medium">Update Profile Picture</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="signOut()" class="w-full p-4 flex items-center justify-between border-b border-gray-100">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-sign-out-alt text-gray-500"></i>
                            </div>
                            <span class="font-medium">Sign Out</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                    
                    <button onclick="showScreen('deleteAccount')" class="w-full p-4 flex items-center justify-between">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-trash-alt text-red-500"></i>
                            </div>
                            <span class="font-medium text-red-500">Delete Account</span>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </button>
                </div>
            </div>
            
            <!-- Hidden file input for profile picture -->
            <input type="file" id="profilePictureInput" accept="image/*" style="display: none;" onchange="uploadProfilePicture()">
            
            <!-- Bottom Navigation -->
            <div class="bottom-nav bg-white border-t border-gray-200">
                <div class="grid grid-cols-4 py-2">
                    <button onclick="showScreen('home')" class="nav-btn flex flex-col items-center py-2 text-gray-500" id="homeNavBtn">
                        <i class="fas fa-home text-xl mb-1"></i>
                        <span class="text-xs">Home</span>
                    </button>
                    
                    <button onclick="showScreen('history')" class="nav-btn flex flex-col items-center py-2 text-gray-500" id="historyNavBtn">
                        <i class="fas fa-history text-xl mb-1"></i>
                        <span class="text-xs">History</span>
                    </button>
                    
                    <button onclick="showScreen('profile')" class="nav-btn flex flex-col items-center py-2 text-blue-600" id="profileNavBtn">
                        <i class="fas fa-user text-xl mb-1"></i>
                        <span class="text-xs">Profile</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Name Screen -->
    <div id="changeName" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-blue-500 text-white p-4 flex items-center">
                <button onclick="showScreen('profile')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Change Profile Name</h2>
            </div>
            
            <!-- Form -->
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">New Name</label>
                    <input type="text" id="newProfileName" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your new name">
                </div>
                
                <button onclick="changeProfileName()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                    Update Name
                </button>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        Your name will be updated across all transactions and your profile.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Terms and Conditions Screen -->
    <div id="terms" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-gray-700 text-white p-4 flex items-center">
                <button onclick="showScreen('profile')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Terms and Conditions</h2>
            </div>
            
            <!-- Terms Content -->
            <div class="p-6">
                <div class="terms-content">
                    <h3 class="text-lg font-semibold mb-3">Fun Pay Educational Platform Terms of Use</h3>
                    
                    <h4 class="font-semibold mt-4 mb-2">1. Educational Purpose Only</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        Fun Pay is an educational platform designed to teach users about digital payment systems. 
                        All transactions are simulated and do not involve real money. This platform is not a financial 
                        institution and does not provide actual banking services.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">2. User Account</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        Users must provide accurate information when creating an account. Each user is responsible for 
                        maintaining the confidentiality of their account credentials, including their password and PIN.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">3. Privacy</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        We respect your privacy and are committed to protecting your personal information. Any data 
                        collected is used solely for educational purposes and to improve the platform experience.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">4. Prohibited Activities</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        Users are prohibited from attempting to use Fun Pay for actual financial transactions, 
                        attempting to compromise the security of the platform, or using the platform for any illegal 
                        or unauthorized purposes.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">5. Intellectual Property</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        All content, features, and functionality of the Fun Pay platform are owned by Fun Pay Educational 
                        Platform and are protected by copyright, trademark, and other intellectual property laws.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">6. Limitation of Liability</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        Fun Pay Educational Platform is not liable for any direct, indirect, incidental, special, or 
                        consequential damages resulting from your use of the platform.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">7. Changes to Terms</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        We reserve the right to modify these terms at any time. Continued use of the platform after 
                        any changes constitutes acceptance of the new terms.
                    </p>
                    
                    <h4 class="font-semibold mt-4 mb-2">8. Contact Information</h4>
                    <p class="text-sm text-gray-600 mb-3">
                        For questions about these terms, please contact us at nboy13031@gmail.com
                    </p>
                    
                    <p class="text-xs text-gray-500 mt-6">
                        Last updated: June 2023
                    </p>
                </div>
                
                <button onclick="showScreen('profile')" class="w-full bg-gray-700 text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition mt-4">
                    I Understand
                </button>
            </div>
        </div>
    </div>

    <!-- Help and Support Screen -->
    <div id="help" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-green-500 text-white p-4 flex items-center">
                <button onclick="showScreen('profile')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Help and Support</h2>
            </div>
            
            <!-- Help Content -->
            <div class="p-6">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">How can we help you?</h3>
                    <p class="text-sm text-gray-600">
                        If you're experiencing any issues with Fun Pay or have questions about how to use the platform, 
                        we're here to help. Please reach out to us using the contact information below.
                    </p>
                </div>
                
                <div class="space-y-4">
                    <div class="contact-item">
                        <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                            <i class="fas fa-envelope text-green-500"></i>
                        </div>
                        <div>
                            <p class="font-medium">Email Support</p>
                            <p class="text-sm text-gray-600">nboy13031@gmail.com</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800 mb-2">Frequently Asked Questions</h4>
                        
                        <div class="mb-3">
                            <p class="font-medium text-sm">Is Fun Pay a real payment app?</p>
                            <p class="text-xs text-gray-600">No, Fun Pay is an educational platform that simulates payment transactions for learning purposes only.</p>
                        </div>
                        
                        <div class="mb-3">
                            <p class="font-medium text-sm">Is my financial information secure?</p>
                            <p class="text-xs text-gray-600">Fun Pay does not handle real money or actual financial information, so there's no financial risk.</p>
                        </div>
                        
                        <div class="mb-3">
                            <p class="font-medium text-sm">How do I reset my PIN?</p>
                            <p class="text-xs text-gray-600">Go to Profile > Change PIN and follow the instructions to update your PIN.</p>
                        </div>
                        
                        <div>
                            <p class="font-medium text-sm">Can I use Fun Pay for real transactions?</p>
                            <p class="text-xs text-gray-600">No, Fun Pay is strictly for educational purposes and cannot be used for real financial transactions.</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        Our support team typically responds within 24-48 hours.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Account Screen -->
    <div id="deleteAccount" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-red-500 text-white p-4 flex items-center">
                <button onclick="showScreen('profile')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Delete Account</h2>
            </div>
            
            <!-- Delete Account Content -->
            <div class="p-6">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
                    <h3 class="text-lg font-semibold text-red-800 mb-3">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Warning
                    </h3>
                    <p class="text-sm text-red-700 mb-3">
                        This action is permanent and cannot be undone. All your account data, including:
                    </p>
                    <ul class="text-sm text-red-700 list-disc list-inside mb-3">
                        <li>Account information</li>
                        <li>Transaction history</li>
                        <li>Account balance</li>
                        <li>Profile settings</li>
                    </ul>
                    <p class="text-sm text-red-700">
                        will be permanently deleted and cannot be recovered.
                    </p>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Type <span class="font-bold">DELETE</span> in capital letters to confirm
                    </label>
                    <input type="text" id="deleteConfirmationText" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="DELETE">
                </div>
                
                <button onclick="deleteAccount()" class="w-full bg-red-500 text-white py-3 rounded-lg font-medium hover:bg-red-600 transition">
                    Delete My Account Permanently
                </button>
                
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <p class="text-xs text-blue-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        If you're having issues with your account, please contact our support team at nboy13031@gmail.com before deleting.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Change PIN Screen -->
    <div id="changePin" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-blue-500 text-white p-4 flex items-center">
                <button onclick="showScreen('profile')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Change PIN</h2>
            </div>
            
            <!-- Form -->
            <div class="p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Current PIN</label>
                    <input type="password" id="currentPin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pin-input" placeholder="••••" maxlength="4">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">New PIN</label>
                    <input type="password" id="newPin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pin-input" placeholder="••••" maxlength="4">
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirm New PIN</label>
                    <input type="password" id="confirmNewPin" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 pin-input" placeholder="••••" maxlength="4">
                </div>
                
                <button onclick="changePin()" class="w-full bg-blue-500 text-white py-3 rounded-lg font-medium hover:bg-blue-600 transition">
                    Change PIN
                </button>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        Remember your PIN. You'll need it for all transactions.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications Screen -->
    <div id="notifications" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-orange-500 text-white p-4 flex items-center">
                <button onclick="showScreen('home')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Notifications</h2>
            </div>
            
            <!-- Notifications List -->
            <div class="p-4">
                <div id="notificationsList" class="bg-white rounded-xl shadow-sm">
                    <p class="text-gray-500 text-center py-4">No notifications</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Show QR Code Screen -->
    <div id="showQR" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-indigo-500 text-white p-4 flex items-center">
                <button onclick="showScreen('profile')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Your QR Code</h2>
            </div>
            
            <!-- QR Code Display -->
            <div class="p-6">
                <div class="qr-container">
                    <div id="qrcode"></div>
                    
                    <div class="bg-gray-50 rounded-xl p-4 mt-6 w-full">
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Account Number:</span>
                            <span class="font-medium" id="qrAccountNumber">FPXXXXXXXXX</span>
                        </div>
                        <div class="flex justify-between mb-2">
                            <span class="text-gray-600">Name:</span>
                            <span class="font-medium" id="qrDisplayName">User Name</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Bank:</span>
                            <span class="font-medium" id="qrBankName">Children Bank of India</span>
                        </div>
                    </div>
                    
                    <div class="mt-6 p-3 bg-blue-50 rounded-lg">
                        <p class="text-xs text-blue-700 text-center">
                            <i class="fas fa-info-circle mr-1"></i>
                            Share this QR code to receive payments
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scan QR Code Screen -->
    <div id="scanQR" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-indigo-500 text-white p-4 flex items-center">
                <button onclick="showScreen('home')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Scan QR Code</h2>
            </div>
            
            <!-- QR Scanner -->
            <div class="p-4">
                <div id="qr-reader"></div>
                
                <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                    <p class="text-xs text-blue-700 text-center">
                        <i class="fas fa-info-circle mr-1"></i>
                        Position the QR code within the frame to scan
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Payment Screen -->
    <div id="qrPay" class="screen">
        <div class="phone-container bg-white">
            <!-- Header -->
            <div class="bg-indigo-500 text-white p-4 flex items-center">
                <button onclick="showScreen('home')" class="mr-3">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h2 class="text-xl font-semibold">Pay via QR Code</h2>
            </div>
            
            <!-- Recipient Details -->
            <div class="p-6">
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Account Number:</span>
                        <span class="font-medium" id="qrPayAccountNumber">FPXXXXXXXXX</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Name:</span>
                        <span class="font-medium" id="qrPayDisplayName">User Name</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Bank:</span>
                        <span class="font-medium" id="qrPayBankName">Children Bank of India</span>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Amount (₹)</label>
                    <input type="number" id="qrPayAmount" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="0.00">
                </div>
                
                <button onclick="processQRPayment()" class="w-full bg-indigo-500 text-white py-3 rounded-lg font-medium hover:bg-indigo-600 transition">
                    Pay
                </button>
                
                <div class="mt-4 p-3 bg-yellow-50 rounded-lg">
                    <p class="text-xs text-yellow-700">
                        <i class="fas fa-info-circle mr-1"></i>
                        You will be asked to enter your PIN to confirm this payment.
                    </p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
